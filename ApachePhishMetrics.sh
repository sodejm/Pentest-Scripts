#!/bin/bash


##Justin Soderbeg
# using this:
# put all the apache logs you want to processes into the same directory
# 'cd' into that directory and run the script
# should output .txt files containing the information needed


#total hits to the first page
echo "#These are the unique visits to the site" > site_metrics.txt
echo "<count>  <address>" >> site_metrics.txt
less ssl_access_log* | grep "/ " | cut -d '-' -f 1 | sort -r | uniq -c | grep -v -E '10.8.161.*|10.18.28.*' >> site_metrics.txt



#unique visits to the sites main survey page
echo "" >> site_metrics.txt
echo "" >> site_metrics.txt
echo "" >> site_metrics.txt
echo "#These are the unique visits to the site that started the survey" >> site_metrics.txt
echo "<count>  <address>" >> site_metrics.txt
less ssl_access_log* | grep "survey.php" | cut -d '-' -f 1 | sort -r | uniq -c | grep -v -E '10.8.161.*|10.18.28.*' >> site_metrics.txt



#unique visits to the thank you page
echo "" >> site_metrics.txt
echo "" >> site_metrics.txt
echo "" >> site_metrics.txt
echo "#These are the unique visits that finished the survey" >> site_metrics.txt
echo "<count>  <address>" >> site_metrics.txt
less ssl_access_log* | grep "thankyou.php" | cut -d '-' -f 1 | sort -r | uniq -c | grep -v -E '10.8.161.*|10.18.28.*' >> site_metrics.txt

