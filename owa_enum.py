#!/bin/python3

# Author: Justin Soderberg
# Prompted idea taken from \
# https://www.peerlyst.com/posts/writing-a-simple-owa-enumeration-script-secgroundzero
# I cannot promise this script works as it was written but not tested in depth yet.


import argparse
import requests


owaDiscoveryPaths= ['/autodiscover/autodiscover.xml','/Autodiscover/Autodiscover.xml']
subdomains = ['www','autodiscover', 'mail', 'exchange', 'webmail']

# Bruteforce subdomains
def bruteForceSubs(domain):
	for path in owaDiscoveryPaths:
		for sub in subdomains:
			siteHTTPS = 'https://'sub + '.' + domain + path
			siteHTTP = 'http://'sub + '.' + domain + path
			rHTTPS = requests.get(siteHTTPS)
			if r.status_code == 200:
				print('[+] ' + siteHTTPS + 'exists!')
			else:
				print('[-] ' + siteHTTPS + 'does not exist!')
			rHTTP = requests.get(siteHTTP)
			if r.status_code == 200:
				print('[+] ' + siteHTTP + 'exists!')
			else:
				print('[-] ' + siteHTTP + 'does not exist!')


def main():	
	# Usage: python3 owa_enum.py <domain>
	parser = argpars.ArgumentParser(description='Enumerate OWA')
	parser.add_argument('-d', '--domain', type=string, help='Add a domain')
	args = parser.parse_args()

	dom = args.domain
	bruteForceSubs(dom)


if __name__ == "__main__":
	main()
