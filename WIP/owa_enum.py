#!/bin/python3

# Author: Justin Soderberg
# Prompted idea taken from \
# https://www.peerlyst.com/posts/writing-a-simple-owa-enumeration-script-secgroundzero


#
# THIS IS NOT COMPLETE, feel free to fork and modify to get it to work before i do.
#

import argparse
import requests


owaDiscoveryPaths= ['/autodiscover/autodiscover.xml','/Autodiscover/Autodiscover.xml']
subdomains = ['www','autodiscover', 'mail', 'exchange', 'webmail']

# Bruteforce subdomains
def bruteForceSubs(domain):
	for path in owaDiscoveryPaths:
		for sub in subdomains:
			siteHTTPS = 'https://'+ sub + '.' + domain + path
			siteHTTP = 'http://' + sub + '.' + domain + path
			rHTTPS = requests.get(siteHTTPS)
			if rHTTPS.status_code == 200:
				print('[+] ' + siteHTTPS + 'exists!')
			else:
				print('[-] ' + siteHTTPS + 'does not exist!')
			rHTTP = requests.get(siteHTTP)
			if rHTTP.status_code == 200:
				print('[+] ' + siteHTTP + 'exists!')
			else:
				print('[-] ' + siteHTTP + 'does not exist!')


def main():	
	# Usage: python3 owa_enum.py <domain>
	parser = argparse.ArgumentParser(description='Enumerate OWA')
	parser.add_argument('-d', '--domain', type=str, help='Add a domain')
	args = parser.parse_args()

	dom = args.domain
	bruteForceSubs(dom)

if __name__ == "__main__":
	main()
