#!/bin/python3

# Author: Justin Soderberg
# Prompted idea taken from \
# https://www.peerlyst.com/posts/writing-a-simple-owa-enumeration-script-secgroundzero

import argparse
import requests


# List of OWA discovery paths to check
owaDiscoveryPaths = ['/autodiscover/autodiscover.xml', '/Autodiscover/Autodiscover.xml', '/owa/auth/logon.aspx']

# List of subdomains to check
subdomains = ['www', 'autodiscover', 'mail', 'exchange', 'webmail']

# Check if a URL returns a successful HTTP status code
def checkURL(url):
    try:
        response = requests.get(url)
        return response.status_code == 200
    except:
        return False

# Check if a live OWA or Exchange instance exists for the given domain
def checkDomain(domain):
    for sub in subdomains:
        for path in owaDiscoveryPaths:
            # Construct the URL to check
            url = f'https://{sub}.{domain}{path}'
            if checkURL(url):
                print(f'[+] {url} exists!')
                return True
    return False

def main():
    # Parse command-line arguments
    parser = argparse.ArgumentParser(description='Check for a live OWA or Exchange instance')
    parser.add_argument('-d', '--domain', type=str, help='Add a domain')
    args = parser.parse_args()

    # Check the provided domain for a live OWA or Exchange instance
    domain = args.domain
    if checkDomain(domain):
        print(f'Live OWA or Exchange instance found for {domain}!')
    else:
        print(f'No live OWA or Exchange instance found for {domain}!')

if __name__ == "__main__":
    main()
